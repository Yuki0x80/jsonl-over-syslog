# syslog-ng設定ファイルの例（TLS通信前提）
# この設定を /etc/syslog-ng/conf.d/telegram-crawler.conf に追加してください

# TLSで受信（ポート6514を使用、RFC 5425推奨）
source s_telegram_crawler_tls {
    tcp(ip(0.0.0.0) 
        port(6514)
        tls(
            key-file("/etc/ssl/private/server.key")
            cert-file("/etc/ssl/certs/server.crt")
            ca-file("/etc/ssl/certs/ca-certificates.crt")
        )
    );
};

# フィルター: アプリケーション名が "telegram-crawler" のメッセージ
filter f_telegram_crawler {
    program("telegram-crawler");
};

# ログファイルへの保存先
destination d_telegram_crawler {
    file("/var/log/telegram-crawler/telegram-crawler-${YEAR}-${MONTH}-${DAY}.log"
         create_dirs(yes)
         template("${ISODATE} ${HOST} ${PROGRAM} ${MSG}\n"));
};

# または、JSONL形式で保存（メッセージ部分のみ）
# destination d_telegram_crawler_raw {
#     file("/var/log/telegram-crawler/telegram-crawler-raw.log"
#          create_dirs(yes)
#          template("${MSG}\n"));
# };

# ログパス: フィルターに一致するメッセージを保存
log {
    source(s_telegram_crawler_tls);
    filter(f_telegram_crawler);
    destination(d_telegram_crawler);
    flags(final);
};
